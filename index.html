<!doctype html>
<html lang='en-GB'>
<head>
  <meta charset='utf-8'>
  <title>Ractive test</title>
   <script src='http://cdn.ractivejs.org/latest/ractive.min.js'></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
   
   <link rel="stylesheet" href="/bootstraptheme.css">
</head>

<body>
  <h1>Ractive test</h1>
  <div id='container'></div>
  <script id='template' type='text/ractive'>
	  <table class="table table-striped table-hover ">
	  <thead>
		<tr>
		  <th>Race No.</th>
		  <th>Race Meeting</th>
		  <th>Closing Time</th>
		</tr>
	  </thead>
	  <tbody>
		<tr>
		  <td>Race 1</td>
		  <td>{{meeting1}}</td>
		  <td>{{race1}}</td>
		</tr>
		 <tr>
		  <td>Race 2</td>
		  <td>{{meeting2}}</td>
		  <td>{{race2}}</td>
		</tr>
		<tr class="info">
		  <td>Race 3</td>
		  <td>{{meeting3}}</td>
		  <td>{{race3}}</td>
		</tr>
		<tr class="success">
		   <td>Race 4</td>
		  <td>{{meeting4}}</td>
		  <td>{{race4}}</td>
		</tr>
		<tr class="danger">
		   <td>Race 5</td>
		  <td>{{meeting5}}</td>
		  <td>{{race5}}</td>
		</tr>
	  </tbody>
	</table> 
  </script>

  
  
  
  <script>
    var ractive = new Ractive({
      el: '#container',
      template: '#template',
      data: { name: 'test world' }
    });
	function setTimer(){
		var test_races = new Array();
		$.ajax({
			type: 'GET',
			url: 'ladbrokesData.php',
			data: 'id=testdata',
			cache: false,
			success: function(result) {
				//$('#content1').html(result[0]);
				
				test_races = jQuery.parseJSON(result);
				for (var i = 0; i < test_races.length; i++) { 
		
					var raceId = "race"+test_races[i][0];
					var meetingId = "meeting"+test_races[i][0];
				
					raceId = raceId.replace(/^\s+|\s+$/g,"");
					 
					var countDownDate = new Date(test_races[i][3]*1000).getTime();
					//var countDownDate = new Date(1490489220*1000).getTime();
					//get todays date
					var now = new Date().getTime();
				
					
					
					// Find the distance between now an the count down date
					var distance = countDownDate - now;
					
				

						// Time calculations for days, hours, minutes and seconds
						var days = Math.floor(distance / (1000 * 60 * 60 * 24));
						var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
						var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
						var seconds = Math.floor((distance % (1000 * 60)) / 1000);

						ractive.set( meetingId,test_races[i][1] );
					if(distance>0){
						ractive.set( raceId, days + "d " + hours + "h "+ minutes + "m " + seconds + "s ");	
						ractive.set( 'name',test_races[i][3] );	
					}else{
						ractive.set( raceId, "Closed");	

					}						
				}
				
				
				
				
				
				
			},
		});	
	
		
	
	}
	
	
	
	
	
	
		//sets inital array of data on load 
		setTimer();
		// ...then update it once a second
		setInterval( function () {
		/*	var race5 = new Date(ractive.get('race1'));
			var now = new Date();
		
		if(race5>now){
			ractive.set('race4',0);
		}else{
			ractive.set('race4','closed');
		}*/
		setTimer();

		
	 
	}, 1000 );
  </script>
  
  
  
</body>
</html>